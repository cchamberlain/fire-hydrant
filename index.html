<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl">
  <title data-ice="title">API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/cchamberlain/fire-hydrant" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-deserialize">deserialize</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-fromHydrant">fromHydrant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-serialize">serialize</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-toHydrant">toHydrant</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><div data-ice="index" class="github-markdown"><h1 id="fire-hydrant">fire-hydrant</h1>
<p><strong>hydration and serialization of state, targeted at Redux Server Side Rendering and ImmutableJS</strong></p>
<p><a href="https://nodei.co/npm/fire-hydrant/"><img src="https://nodei.co/npm/fire-hydrant.png?stars=true&amp;downloads=true" alt="NPM"></a></p>
<h2 id="install">Install</h2>
<p><code>npm i -S fire-hydrant</code></p>
<h2 id="documentation">Documentation</h2>
<p>Functions used to store state objects, partial immutables, and full immutables to strings and restore them back to their original state.</p>
<h2 id="example-with-react-router-https-npmjs-com-package-react-router-and-react-router-redux-https-npmjs-com-package-react-router-redux-with-async-routes">Example with <a href="https://npmjs.com/package/react-router">react-router</a> and <a href="https://npmjs.com/package/react-router-redux">react-router-redux</a> with async routes</h2>
<h4 id="configurestore-js">configureStore.js</h4>
<pre><code class="lang-js"><code class="source-code prettyprint">import { createStore, applyMiddleware } from &apos;redux&apos;
import { routerMiddleware } from &apos;react-router-redux&apos;
import { combineReducers } from &apos;redux&apos;
import * as reducers from &apos;../reducers&apos;

export default function configureStore(history, initialState) {
  const reducer = combineReducers(reducers)
  const enhancer = applyMiddleware([ routerMiddleware(history) ])
  return createStore(reducer, initialState, enhancer)
}</code>
</code></pre>
<h4 id="createrouter-js">createRouter.js</h4>
<p><strong>Plug this router into your server.use()</strong></p>
<pre><code class="lang-jsx"><code class="source-code prettyprint">import Router from &apos;router&apos;
import { Provider } from &apos;react-redux&apos;
import { createMemoryHistory, match, RouterContext } from &apos;react-router&apos;
import { syncHistoryWithStore } from &apos;react-router-redux&apos;

import { serialize } from &apos;fire-hydrant&apos;

/** Routes can be direct server defined routes or a webpack bundle */
import routes from &apos;./routes&apos;


const InitialState = ({ state }) =&gt; {
  const serialized = serialize(state)
  const __html = `window.__initialState__ = ${serialized}`
  return &lt;script dangerouslySetInnerHTML={{ __html }} /&gt;
}

const HTML = ({ content, store }) =&gt; {
  const state = store ? store.getState() : noop()

  return (
    &lt;html&gt;
      &lt;head&gt;
        &lt;meta charSet=&quot;utf-8&quot; /&gt;
        &lt;title&gt;Fire Hydrant&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;InitialState state={state} /&gt;
        &lt;div id=&quot;root&quot; dangerouslySetInnerHTML={{ __html: content }}/&gt;
        &lt;script src=&quot;/app.js&quot; /&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  )
}

const renderHTML = props =&gt; `&lt;!doctype html&gt;
${renderToString(&lt;HTML {...props} /&gt;)}`

export default function createRouter({ cors, paths }) {
  const router = Router()
  router.use((req, res, next) =&gt; {
    try {
      const memoryHistory = createMemoryHistory(req.path)
      let store = configureStore(memoryHistory)
      const history = syncHistoryWithStore(memoryHistory, store)

      match({ history, routes, location: req.url }, (error, redirectLocation, renderProps) =&gt; {
        if (error)
          res.status(500).send(error.message)
        else if (redirectLocation)
          res.redirect(302, redirectLocation.pathname + redirectLocation.search)
        else if (renderProps) {
          const content = renderToString(&lt;Provider store={store}&gt;&lt;RouterContext {...renderProps} /&gt;&lt;/Provider&gt;)
          res.send(renderHTML({ content, store }))
        } else
          next()
      })
    } catch(routerError) {
      res.status(500).send(process.env.NODE_ENV !== &apos;production&apos; ? routerError : &apos;An error occurred rendering the application.&apos;)
    }
  })
  return router
}</code>
</code></pre>
<h4 id="app-js">app.js</h4>
<p><strong>Client entry point - This is where the state gets rehydrated.</strong></p>
<pre><code class="lang-jsx"><code class="source-code prettyprint">import React from &apos;react&apos;
import { render } from &apos;react-dom&apos;
import { Provider } from &apos;react-redux&apos;
import { match, Router, browserHistory } from &apos;react-router&apos;
import { syncHistoryWithStore } from &apos;react-router-redux&apos;

import { fromHydrant } from &apos;fire-hydrant&apos;

import routes from &apos;./routes&apos;

/** Rehydrate our server built state that is stored in __initialState__ global */
const initialState = fromHydrant(window.__initialState__ || {})

const store = configureStore(browserHistory, initialState)
const history = syncHistoryWithStore(browserHistory, store)

const rootElement = document.getElementById(&apos;root&apos;)
match({ history, routes }, (err, redirectLocation, renderProps) =&gt; {
  render(&lt;Provider store={store}&gt;&lt;Router {...renderProps} /&gt;&lt;/Provider&gt;, rootElement)
})</code>
</code></pre>
<h2 id="unit-tests">Unit tests</h2>
<pre><code class="lang-js"><code class="source-code prettyprint">const regularObj =  { a: &apos;something&apos;
                    , b: [1, 2, 3]
                    , c: { foo: { bar: true }}
                    }
const partialImmutable =  { ...regularObj
                          , d: Immutable.Map({ a: &apos;foo&apos;, b: &apos;bar&apos; })
                          }
const topLevelImmutable = Immutable.fromJS(regularObj)



it(&apos;should toHydrant to an object&apos;, () =&gt; expect(toHydrant({ foo: &apos;bar&apos; })).toEqual(jasmine.any(Object)))
it(&apos;should fromHydrant to an object&apos;, () =&gt; expect(fromHydrant({ foo: &apos;bar&apos; })).toEqual(jasmine.any(Object)))
it(&apos;should serialize to a string&apos;, () =&gt; expect(serialize({ foo: &apos;bar&apos; })).toEqual(jasmine.any(String)))
it(&apos;should deserialize to an object&apos;, () =&gt; expect(deserialize(`{&quot;foo&quot;: &quot;bar&quot;}`)).toEqual(jasmine.any(Object)))

it(&apos;should be able to toHydrant and fromHydrant back for regular object&apos;, () =&gt; {
  let hydrant = toHydrant(regularObj)
  let result = fromHydrant(hydrant)
  expect(result).toEqual(regularObj)
})

it(&apos;should be able to toHydrant and fromHydrant back for partial immutable&apos;, () =&gt; {
  let hydrant = toHydrant(partialImmutable)
  let result = fromHydrant(hydrant)
  expect(result).toEqual(partialImmutable)
})

it(&apos;should be able to toHydrant and fromHydrant back for top level immutable&apos;, () =&gt; {
  let hydrant = toHydrant(topLevelImmutable)
  let result = fromHydrant(hydrant)
  expect(result).toEqual(topLevelImmutable)
})

it(&apos;should be able to serialize and deserialize to same values for regular object&apos;, () =&gt; {
  let serialized = serialize(regularObj)
  let result = deserialize(serialized)
  expect(result).toEqual(regularObj)
})

it(&apos;should be able to serialize and deserialize to same values for partial immutable&apos;, () =&gt; {
  let serialized = serialize(partialImmutable)
  let result = deserialize(serialized)
  expect(result).toEqual(partialImmutable)
})

it(&apos;should be able to serialize and deserialize to same values for top level immutable&apos;, () =&gt; {
  let serialized = serialize(topLevelImmutable)
  let result = deserialize(serialized)
  expect(result).toEqual(topLevelImmutable)
})</code>
</code></pre>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.7)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
